import{j as e,y as d,W as S,r as h,a as D}from"./app-CJl1LCko.js";import{f as w,X as z,e as I,h as L,r as $}from"./functions-Dak7x-2Q.js";import{M as F}from"./Modal-CxFFwzUK.js";import{P as k}from"./PrimaryButton-DHAo9yMn.js";import{c as o}from"./createLucideIcon-B9nH5JaY.js";import{P as R}from"./ProofInput-KY5CVi-N.js";import{C as p}from"./CustomInput-BzJSrjGl.js";import{S as T}from"./SubmitButton-DtKeg_18.js";import{P as O}from"./phone-NqCjTc9o.js";import{a as U}from"./settings-BIJA3b73.js";/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=o("ArrowBigUpDash",[["path",{d:"M9 19h6",key:"456am0"}],["path",{d:"M9 15v-3H5l7-7 7 7h-4v3H9z",key:"1r2uve"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=o("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=o("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=o("HandCoins",[["path",{d:"M11 15h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 17",key:"geh8rc"}],["path",{d:"m7 21 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"1fto5m"}],["path",{d:"m2 16 6 6",key:"1pfhp9"}],["circle",{cx:"16",cy:"9",r:"2.9",key:"1n0dlu"}],["circle",{cx:"6",cy:"5",r:"3",key:"151irh"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=o("ImageOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=o("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=o("MessageCircleOff",[["path",{d:"M20.5 14.9A9 9 0 0 0 9.1 3.5",key:"1iebmn"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.6 5.6C3 8.3 2.2 12.5 4 16l-2 6 6-2c3.4 1.8 7.6 1.1 10.3-1.7",key:"1ov8ce"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=o("TimerReset",[["path",{d:"M10 2h4",key:"n1abiw"}],["path",{d:"M12 14v-4",key:"1evpnu"}],["path",{d:"M4 13a8 8 0 0 1 8-7 8 8 0 1 1-5.3 14L4 17.6",key:"1ts96g"}],["path",{d:"M9 17H4v5",key:"8t5av"}]]);function J({bond:t,closeHandler:l}){function a(n){d.post(`/bonds/${t.id}`,{status:n=="none"?null:n,_method:"PATCH"},{onStart:l})}return e.jsxs("div",{children:[e.jsxs("p",{className:"mb-4",children:["تريد إثبات الدفع الخاص بتاريخ"," ",w(new Date(t.payement_date))]}),t.postable==1?e.jsxs("div",{className:"flex flex-col gap-4 text-sm",children:[t.status!=="posted"&&e.jsxs("button",{className:"rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",onClick:()=>a("posted"),children:[e.jsx(V,{className:"ml-2 inline-block"}),"تم ايداع الشيك"]}),t.status!=="paid"&&e.jsxs("button",{onClick:()=>a("paid"),className:"rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(v,{className:"ml-2 inline-block"}),"تم صرف الشيك"]}),t.status!=="denied"&&e.jsxs("button",{onClick:()=>a("denied"),className:"hover:bg-red rounded-lg border border-red-300 bg-red-100 py-2 text-red-700 transition-colors hover:text-red-500",children:[e.jsx(z,{className:"ml-2 inline-block"}),"شيك مرتجع"]}),t.status!==null&&e.jsxs("button",{onClick:()=>a("none"),className:"hover:bg-red rounded-lg border border-slate-300 bg-slate-100 py-2 text-slate-700 transition-colors hover:text-slate-500",children:[e.jsx(N,{className:"ml-2 inline-block"}),"بدون الحالة"]})]}):e.jsx("div",{className:"flex flex-col gap-4 text-sm",children:t.status!=="paid"?e.jsxs("button",{onClick:()=>a("paid"),className:"rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(v,{className:"ml-2 inline-block"}),"إثبات الدفع"]}):e.jsxs("button",{onClick:()=>a("none"),className:"hover:bg-red rounded-lg border border-slate-300 bg-slate-100 py-2 text-slate-700 transition-colors hover:text-slate-500",children:[e.jsx(N,{className:"ml-2 inline-block"}),"إلغاء الدفع"]})})]})}function K({proof:t,closeHandler:l}){const{data:a,setData:n,post:m,processing:i,errors:x}=S({payement_date:t.payement_date,title:t.title,postable:t.postable,action_done:t.action_done,proof_image:t.proof_image,_method:"PATCH"});function g(s){s.preventDefault(),m(route("bonds.update",t.id),{preserveScroll:!1,onSuccess:l})}return e.jsx("div",{className:"w-full",children:e.jsxs("form",{onSubmit:g,children:[e.jsx(R,{changeHandler:s=>n({...a,...s}),proof:t}),e.jsx("div",{className:"my-3",children:e.jsx(p,{type:"date",label:"تاريخ دفعة",onChange:s=>n("payement_date",s.target.value),defaultValue:a.payement_date,name:"payement_date",id:"contracts-payement_date",error:x.payement_date})}),e.jsx("div",{className:"my-3",children:e.jsx(p,{label:"ملاحظة",onChange:s=>n("action_done",s.target.value),defaultValue:a.action_done,name:"action_done",id:"contracts-action_done",error:x.action_done})}),e.jsx(T,{loading:i,children:"تحديث"})]})})}function Q({bond:t,noActions:l,ranking:a,last:n}){var y,b,f,j;const m=h.useRef(),i=I(t.status),[x,g]=h.useState(),[s,r]=h.useState(!1),[C,_]=h.useState();async function P(c){const H=await $(c.target.files[0]);d.post(route("bonds.update",t.id),{proof_image:H,_method:"PATCH"})}const u={markAsPaid:{text:e.jsx(J,{bond:t,closeHandler:()=>r("")})},delayBond:{text:"هل أنت متأكد من أنك تريد تأخير هذا الدفع إلى بداية الشهر القادم؟",action:M},updateBond:{text:e.jsx(K,{closeHandler:()=>r(""),proof:t})},showProof:{text:e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.proof_image,className:"md:max-h-[450px]",alt:"لا يوجد صورة"}),e.jsx("p",{children:"هل تريد تغيير الصورة؟"})]}),action:()=>m.current.click()},partPayement:{text:e.jsx(p,{label:"أدخل الجزء المدفوع",placeholder:"(ستتم إضافة الباقي للشهر المقبل)",onChange:c=>_(c.target.value),type:"number",min:"0"}),action:A},changeAmount:{text:e.jsx(p,{label:"أدخل مبلغ الدفعة",placeholder:"(ستتم تقسيم الباقي للأشهر المقبلة)",onChange:c=>g(c.target.value),type:"number",min:"0"}),action:B}};function M(){d.post(`/bonds/${t.id}/delay`,{_method:"PATCH"},{onStart:()=>r(!1)})}function A(){d.post(`/bonds/${t.id}/part`,{amount_paid:C,_method:"PATCH"},{onStart:()=>r(!1)})}function B(){d.post(`/bonds/${t.id}`,{amount:x,_method:"PATCH"},{onStart:()=>r(!1)})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`mb-4 rounded-xl border px-3 py-4 transition-colors duration-500 ${t.status=="paid"?"border-green-500 bg-green-100":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[l?t.action_done==="دفعة متأخرة"?e.jsx("p",{className:"border-l border-l-gray-500 pl-3",children:"دفعة متأخرة"}):e.jsxs("p",{className:"border-l border-l-gray-500 pl-3",children:["الدفعة ",a]}):e.jsx("div",{children:e.jsx("button",{onClick:()=>r("markAsPaid"),className:`${t.status?i.bg:"bg-gray-200"} flex h-9 w-9 items-center justify-center rounded-xl transition-colors`,children:t.status&&i?e.jsx(i.icon,{className:`transition-all duration-500 ${t.status?"scale-100 opacity-100":"scale-0 opacity-0"}`}):null})}),e.jsxs("div",{children:[e.jsxs("span",{className:"block font-medium",children:[parseFloat(t.amount).toFixed(2)," درهم"," ",!t.postable&&e.jsx("span",{className:"mb-4 whitespace-nowrap rounded-full bg-orange-100 px-4 py-1 text-center text-xs text-orange-800",children:"شيك ضمان"})," ",t.action_done&&!l&&e.jsx("span",{className:"mb-4 whitespace-nowrap rounded-full bg-violet-100 px-2 py-1 text-center text-xs text-violet-800",children:t.action_done})]}),e.jsx("span",{className:`text-xs ${new Date(t.payement_date)<new Date&&!t.status?"text-red-500":"text-gray-500"}`,children:t.status?w(new Date(t.payement_date)):L(t.payement_date)})]})]}),e.jsxs("div",{className:"flex gap-1",children:[((y=t.contract)==null?void 0:y.client.id)&&e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"rounded-lg border border-gray-300 bg-gray-100 px-2 py-2 text-xs text-gray-700 transition-colors hover:bg-black hover:text-white",href:route("clients.show",t.contract.client.id),children:t.contract.client.full_name}),e.jsx("a",{className:"w-10 rounded-lg border border-gray-300 bg-gray-100 px-2 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",href:"tel:"+t.contract.client.phone,children:e.jsx(O,{className:"inline-block",size:20})})]}),!l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"w-10 rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",onClick:()=>r("showProof"),children:t.proof_image?e.jsx(X,{className:"inline-block",size:20}):e.jsx(q,{className:"inline-block",size:20})}),e.jsx("button",{onClick:()=>r("updateBond"),className:"w-10 rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:e.jsx(U,{className:"inline-block",size:20})})]}),l&&e.jsxs("div",{className:"flex flex-col",children:[t.action_done&&e.jsx("span",{className:"mb-4 whitespace-nowrap rounded-full bg-violet-100 px-2 py-1 text-center text-xs text-violet-800",children:t.action_done}),t.status&&e.jsx("span",{className:`mb-4 whitespace-nowrap rounded-full px-2 py-1 text-center text-xs ${i.bg}`,children:i.label})]})]}),e.jsx("input",{ref:m,onChange:P,className:"hidden",type:"file"})]}),!t.status&&!l&&e.jsxs("div",{className:"mt-6 flex gap-2 text-sm",children:[e.jsxs("button",{onClick:()=>r("delayBond"),className:"w-full rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(G,{className:"ml-2 inline-block"})," تأجيل الدفعة"]}),!n&&e.jsxs("button",{onClick:()=>r("changeAmount"),className:"w-full rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(E,{className:"ml-2 inline-block"})," ","تغيير المبلغ"]}),e.jsxs("button",{onClick:()=>r("partPayement"),className:"w-full rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(W,{className:"ml-2 inline-block"})," دفع جزئي"]})]})]}),e.jsx(F,{maxWidth:"lg",show:s,children:e.jsxs("div",{className:"px-8 py-10",children:[e.jsx("h2",{className:"mb-5",children:(b=u[s])==null?void 0:b.text}),e.jsxs("div",{className:"flex gap-4",children:[((f=u[s])==null?void 0:f.action)&&e.jsx(k,{className:"text-xl",onClick:(j=u[s])==null?void 0:j.action,children:"نعم"}),e.jsx(k,{className:"text-xl",onClick:()=>r(!1),children:"رجوع"})]})]})})]})}function ie({bonds:t,noActions:l}){return e.jsx("div",{className:"mt-8 w-full",children:t.map((a,n)=>e.jsx(Q,{noActions:l,ranking:n+1,bond:a,last:n===t.length-1},a.id))})}export{ie as B};
