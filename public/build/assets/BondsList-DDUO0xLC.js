import{j as e,y as d,W as A,r as m,a as H}from"./app-Bv1FsUGM.js";import{f as N,X as B,g as S,c as D}from"./functions-B1sCho5i.js";import{M as R}from"./Modal-DlWt9QK7.js";import{P as j}from"./PrimaryButton-D8KxzKFw.js";import{c as l}from"./createLucideIcon-BEqXvAMZ.js";import{P as T}from"./ProofInput-BUxWekF-.js";import{C as g}from"./CustomInput-fte2MIu3.js";import{S as F}from"./SubmitButton-BvdGCXVj.js";import{P as L}from"./phone-iFv0Rm4K.js";import{S as $}from"./InsideLayout-DddR65vh.js";/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=l("ArrowBigUpDash",[["path",{d:"M9 19h6",key:"456am0"}],["path",{d:"M9 15v-3H5l7-7 7 7h-4v3H9z",key:"1r2uve"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=l("ArrowLeftRight",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=l("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=l("HandCoins",[["path",{d:"M11 15h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 17",key:"geh8rc"}],["path",{d:"m7 21 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"1fto5m"}],["path",{d:"m2 16 6 6",key:"1pfhp9"}],["circle",{cx:"16",cy:"9",r:"2.9",key:"1n0dlu"}],["circle",{cx:"6",cy:"5",r:"3",key:"151irh"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=l("MessageCircleOff",[["path",{d:"M20.5 14.9A9 9 0 0 0 9.1 3.5",key:"1iebmn"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.6 5.6C3 8.3 2.2 12.5 4 16l-2 6 6-2c3.4 1.8 7.6 1.1 10.3-1.7",key:"1ov8ce"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=l("ReceiptText",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M14 8H8",key:"1l3xfs"}],["path",{d:"M16 12H8",key:"1fr5h0"}],["path",{d:"M13 16H8",key:"wsln4y"}]]);/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=l("TimerReset",[["path",{d:"M10 2h4",key:"n1abiw"}],["path",{d:"M12 14v-4",key:"1evpnu"}],["path",{d:"M4 13a8 8 0 0 1 8-7 8 8 0 1 1-5.3 14L4 17.6",key:"1ts96g"}],["path",{d:"M9 17H4v5",key:"8t5av"}]]);function V({bond:t,closeHandler:o}){function a(r){d.post(`/bonds/${t.id}`,{status:r=="none"?null:r,_method:"PATCH"},{onStart:o})}return e.jsxs("div",{children:[e.jsxs("p",{className:"mb-4",children:["تريد إثبات الدفع الخاص بتاريخ"," ",N(new Date(t.payement_date))]}),t.postable==1?e.jsxs("div",{className:"flex flex-col gap-4 text-sm",children:[t.status!=="posted"&&e.jsxs("button",{className:"rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",onClick:()=>a("posted"),children:[e.jsx(z,{className:"ml-2 inline-block"}),"تم ايداع الشيك"]}),t.status!=="paid"&&e.jsxs("button",{onClick:()=>a("paid"),className:"rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(k,{className:"ml-2 inline-block"}),"تم صرف الشيك"]}),t.status!=="denied"&&e.jsxs("button",{onClick:()=>a("denied"),className:"hover:bg-red rounded-lg border border-red-300 bg-red-100 py-2 text-red-700 transition-colors hover:text-red-500",children:[e.jsx(B,{className:"ml-2 inline-block"}),"شيك مرتجع"]}),t.status!==null&&e.jsxs("button",{onClick:()=>a("none"),className:"hover:bg-red rounded-lg border border-slate-300 bg-slate-100 py-2 text-slate-700 transition-colors hover:text-slate-500",children:[e.jsx(v,{className:"ml-2 inline-block"}),"بدون الحالة"]})]}):e.jsx("div",{className:"flex flex-col gap-4 text-sm",children:t.status!=="paid"?e.jsxs("button",{onClick:()=>a("paid"),className:"rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(k,{className:"ml-2 inline-block"}),"إثبات الدفع"]}):e.jsxs("button",{onClick:()=>a("none"),className:"hover:bg-red rounded-lg border border-slate-300 bg-slate-100 py-2 text-slate-700 transition-colors hover:text-slate-500",children:[e.jsx(v,{className:"ml-2 inline-block"}),"إلغاء الدفع"]})})]})}function W({proof:t,closeHandler:o}){const{data:a,setData:r,post:h,processing:x,errors:i}=A({payement_date:t.payement_date,title:t.title,postable:t.postable,proof_image:t.proof_image,_method:"PATCH"});function s(n){n.preventDefault(),h(route("bonds.update",t.id),{preserveScroll:!1,onSuccess:o})}return e.jsx("div",{className:"w-full",children:e.jsxs("form",{onSubmit:s,children:[e.jsx(T,{changeHandler:n=>r({...a,...n}),proof:t}),e.jsx("div",{className:"my-3",children:e.jsx(g,{type:"date",label:"تاريخ دفعة",onChange:n=>r("payement_date",n.target.value),defaultValue:a.payement_date,name:"payement_date",id:"contracts-payement_date",error:i.payement_date})}),e.jsx(F,{loading:x,children:"تحديث"})]})})}function q({bond:t,noActions:o}){var u,y,b,f;const a=m.useRef(),r=S(t.status),[h,x]=m.useState(),[i,s]=m.useState(!1),[n,w]=m.useState();function C(c){d.post(route("bonds.update",t.id),{proof_image:c.target.files[0],_method:"PATCH"})}const p={markAsPaid:{text:e.jsx(V,{bond:t,closeHandler:()=>s("")})},delayBond:{text:"هل أنت متأكد من أنك تريد تأخير هذا الدفع إلى بداية الشهر القادم؟",action:P},updateBond:{text:e.jsx(W,{closeHandler:()=>s(""),proof:t})},showProof:{text:e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.proof_image,className:"md:max-h-[450px]",alt:"لا يوجد صورة"}),e.jsx("p",{children:"هل تريد تغيير الصورة؟"})]}),action:()=>a.current.click()},partPayement:{text:e.jsx(g,{label:"أدخل الجزء المدفوع",placeholder:"(ستتم إضافة الباقي للشهر المقبل)",onChange:c=>w(c.target.value),type:"number",min:"0"}),action:M},changeAmount:{text:e.jsx(g,{label:"أدخل مبلغ الدفعة",placeholder:"(ستتم تقسيم الباقي للأشهر المقبلة)",onChange:c=>x(c.target.value),type:"number",min:"0"}),action:_}};function P(){d.post(`/bonds/${t.id}/delay`,{_method:"PATCH"},{onStart:()=>s(!1)})}function M(){d.post(`/bonds/${t.id}/part`,{amount_paid:n,_method:"PATCH"},{onStart:()=>s(!1)})}function _(){d.post(`/bonds/${t.id}`,{amount:h,_method:"PATCH"},{onStart:()=>s(!1)})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`mb-4 rounded-xl border px-3 py-4 transition-colors duration-500 ${t.status=="paid"?"border-green-500 bg-green-100":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{children:e.jsx("button",{onClick:()=>s("markAsPaid"),className:`${t.status?r.bg:"bg-gray-200"} flex h-9 w-9 items-center justify-center rounded-xl transition-colors`,children:t.status&&r?e.jsx(r.icon,{className:`transition-all duration-500 ${t.status?"scale-100 opacity-100":"scale-0 opacity-0"}`}):null})}),e.jsxs("div",{children:[e.jsxs("span",{className:"block font-medium",children:[parseFloat(t.amount).toFixed(2)," درهم"," ",!t.postable&&e.jsx("span",{className:"mb-4 whitespace-nowrap rounded-full bg-orange-100 px-4 py-1 text-center text-xs text-orange-800",children:"شيك ضمان"})]}),e.jsx("span",{className:`text-xs ${new Date(t.payement_date)<new Date&&!t.status?"text-red-500":"text-gray-500"}`,children:t.status?N(new Date(t.payement_date)):D(t.payement_date)})]})]}),e.jsxs("div",{className:"flex gap-1",children:[((u=t.contract)==null?void 0:u.client.id)&&e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"rounded-lg border border-gray-300 bg-gray-100 px-2 py-2 text-xs text-gray-700 transition-colors hover:bg-black hover:text-white",href:route("clients.show",t.contract.client.id),children:t.contract.client.full_name}),e.jsx("a",{className:"w-10 rounded-lg border border-gray-300 bg-gray-100 px-2 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",href:"tel:"+t.contract.client.phone,children:e.jsx(L,{className:"inline-block",size:20})})]}),!o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"w-10 rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",onClick:()=>s("showProof"),children:e.jsx(E,{className:"inline-block",size:20})}),e.jsx("button",{onClick:()=>s("updateBond"),className:"w-10 rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:e.jsx($,{className:"inline-block",size:20})})]})]}),e.jsx("input",{ref:a,onChange:C,className:"hidden",type:"file"})]}),!t.status&&!o&&e.jsxs("div",{className:"mt-6 flex gap-2 text-sm",children:[e.jsxs("button",{onClick:()=>s("delayBond"),className:"w-full rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(U,{className:"ml-2 inline-block"})," تأجيل الدفعة"]}),e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>s("changeAmount"),className:"w-full rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(I,{className:"ml-2 inline-block"})," ","تغيير المبلغ"]})," ",e.jsxs("button",{onClick:()=>s("partPayement"),className:"w-full rounded-lg border border-gray-300 bg-gray-100 py-2 text-gray-700 transition-colors hover:bg-black hover:text-white",children:[e.jsx(O,{className:"ml-2 inline-block"})," دفع جزئي"]})]})]})]}),e.jsx(R,{maxWidth:"lg",show:i,children:e.jsxs("div",{className:"px-8 py-10",children:[e.jsx("h2",{className:"mb-5",children:(y=p[i])==null?void 0:y.text}),e.jsxs("div",{className:"flex gap-4",children:[((b=p[i])==null?void 0:b.action)&&e.jsx(j,{className:"text-xl",onClick:(f=p[i])==null?void 0:f.action,children:"نعم"}),e.jsx(j,{className:"text-xl",onClick:()=>s(!1),children:"رجوع"})]})]})})]})}function se({bonds:t,noActions:o}){return e.jsx("div",{className:"mt-8 w-full",children:t.map(a=>e.jsx(q,{noActions:o,bond:a},a.id))})}export{se as B};
