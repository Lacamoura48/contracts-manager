import{r as l,j as t,y as c,a as h}from"./app-1Xwr3j2F.js";import{A as p,a as g}from"./Autocomplete-Bdj0VKvL.js";import{P as j}from"./PrimaryButton-BJ9KihL6.js";import{g as f,b,c as y}from"./functions-D-pPGhkv.js";import{X as w}from"./transition-CizVyvXQ.js";import{c as N}from"./createLucideIcon-DTezSfTo.js";import{S as C}from"./square-pen-BlZTD_Jb.js";import{X as k}from"./x-EB9Axt3V.js";import{T as u,I as v,P,A as L}from"./Pagination-CONxIr9O.js";import{E as F}from"./EmptyList-CnKNTB-R.js";import{A as S,I as D}from"./InsideLayout-CDlWnFEd.js";import{C as T}from"./circle-plus-B7zGYJM0.js";import"./loader-circle-n8Q3zkey.js";import"./settings-cr5HS0gz.js";/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=N("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function _(){const e=new URLSearchParams(window.location.search),[s,r]=l.useState({}),a=n=>{n.preventDefault(),c.get(route("contracts.index"),{...s})};return t.jsx("div",{className:"mb-5 py-3",children:t.jsxs("form",{onSubmit:a,method:"get",className:"flex items-end gap-2",children:[t.jsx(p,{placeholder:"إختر زبونا",dataFunction:async n=>g("clients",n),defaultValue:e.get("client_id"),choiceHandler:n=>r(i=>({...i,client_id:n})),listItemAtributeName:"full_name",id:"contract-filter-form",label:"الزبون"}),t.jsx(j,{type:"submit",className:"w-24",children:"بحث"})]})})}const E=({bonds:e})=>t.jsx("div",{className:"flex max-w-28 flex-wrap gap-1",children:e.map((s,r)=>t.jsx("div",{className:`h-4 w-4 rounded-full ${s}`},r))}),m=l.createContext(),o=({children:e})=>{const[s,r]=l.useState(!1),a=n=>{n.stopPropagation(),r(i=>!i)};return t.jsx(m.Provider,{value:{open:s,setOpen:r,toggleOpen:a},children:t.jsx("div",{className:"relative",children:e})})},I=({children:e})=>{const{open:s,setOpen:r,toggleOpen:a}=l.useContext(m);return t.jsxs(t.Fragment,{children:[t.jsx("div",{onClick:a,children:e}),s&&t.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>r(!1)})]})},R=({align:e="right",width:s="48",contentClasses:r="py-1 bg-white",children:a})=>{const{open:n,setOpen:i}=l.useContext(m);let d="origin-top";e==="left"?d="ltr:origin-top-left rtl:origin-top-right start-0":e==="right"&&(d="ltr:origin-top-right rtl:origin-top-left end-0");let x="";return s==="48"&&(x="w-48"),t.jsx(t.Fragment,{children:t.jsx(w,{show:n,enter:"transition ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:t.jsx("div",{className:`absolute z-50 mt-2 rounded-md shadow-lg ${d} ${x}`,onClick:()=>i(!1),children:t.jsx("div",{className:"rounded-md ring-1 ring-black ring-opacity-5 "+r,children:a})})})})},O=({className:e="",children:s,...r})=>t.jsx(h,{...r,className:"block w-full px-4 py-2 text-start text-sm leading-5 text-gray-700 transition duration-150 ease-in-out hover:bg-gray-100 focus:bg-gray-100 focus:outline-none "+e,children:s});o.Trigger=I;o.Content=R;o.Link=O;function q({contractId:e}){const s=new URLSearchParams(window.location.search);function r(){c.post(route("contracts.trash",e),{_method:"patch"})}function a(){c.delete(route("contracts.destroy",e))}return t.jsxs(o,{children:[t.jsx(o.Trigger,{children:t.jsx("button",{className:"h-8 w-8 rounded-full bg-gray-200",children:t.jsx(A,{className:"mx-auto"})})}),t.jsxs(o.Content,{children:[s.get("trash")!=1?t.jsxs(o.Link,{href:route("contracts.edit",e),children:[t.jsx(C,{className:"inline-block"})," تعديل"]}):t.jsxs("button",{onClick:a,className:"block px-4 py-1 text-gray-700",children:[t.jsx(k,{className:"inline-block"})," حذف"]}),t.jsx("button",{onClick:r,className:"px-4 py-1 text-gray-700",children:s.get("trash")!=1?t.jsxs(t.Fragment,{children:[t.jsx(u,{className:"inline-block"})," إهمال"]}):t.jsxs(t.Fragment,{children:[t.jsx(v,{className:"inline-block"})," إرجاع"]})})]})]})}function B({contract:e}){function s(){c.get(route("contracts.show",e.id))}const r=l.useMemo(()=>e.bonds.map(n=>f(n.status,n.payement_date)),[e.bonds]),a=l.useMemo(()=>b(r),[r]);return t.jsxs("tr",{className:"cursor-pointer",children:[t.jsx("td",{onClick:s,className:"hidden border-b py-4 text-start md:block",children:t.jsx("span",{className:`block rounded-lg py-2 text-center font-bold ${a.color}`,children:a.label})}),t.jsx("td",{onClick:s,className:"border-b py-4 text-start md:mr-5 md:pr-10",children:e.client.full_name}),t.jsx("td",{onClick:s,className:"me-5 border-b py-4 text-start",children:new Date(y(e.bonds)).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}),t.jsx("td",{onClick:s,className:"me-5 w-28 border-b py-4 text-start md:w-44 lg:w-72",children:t.jsx(E,{bonds:r})}),t.jsx("td",{className:"pr-3",children:t.jsx(q,{contractId:e.id})})]})}function $({contracts:e}){return t.jsxs("table",{className:"mt-12 w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"w-full",children:[t.jsx("th",{scope:"col",className:"hidden rounded-full bg-black px-2 py-1 text-start text-sm text-white md:block",children:"الحالة"}),t.jsx("th",{scope:"col",className:"mb-2 rounded-full bg-black px-2 py-1 text-start text-sm text-white md:pr-10",children:"الزبون"}),t.jsx("th",{scope:"col",className:"mb-2 rounded-full bg-black px-2 py-1 text-start text-sm text-white",children:"تاريخ الدفعة القادمة"}),t.jsx("th",{scope:"col",className:"mb-2 rounded-full bg-black px-2 py-1 text-start text-sm text-white",children:"حالةالدفعات"}),t.jsx("th",{})]})}),t.jsx("tbody",{children:e.data.map(s=>t.jsx(B,{contract:s},s.id))}),t.jsx("tfoot",{children:t.jsx("tr",{children:t.jsx("td",{colSpan:4,children:t.jsx("div",{className:"mt-12 flex justify-center",children:t.jsx(P,{data:e})})})})})]})}function et({contracts:e}){const s=new URLSearchParams(window.location.search);return t.jsx(S,{children:t.jsxs(D,{headerTitle:s.get("trash")!=1?"العقود":"العقود المهملة",noBack:!0,headerLink:[{label:"إضافة عقد جديد",url:"/contracts/create",icon:T},s.get("trash")!=1?{label:"المهملات",url:"/contracts?trash=1",icon:u}:{label:"عودة للعقود",url:"/contracts",icon:L}],children:[t.jsx(_,{}),t.jsx("img",{className:"w-[20rem]",src:"/icons/status_table.png",alt:"status table image"}),e.data.length>0?t.jsx($,{contracts:e}):t.jsx(F,{model:"عقود"})]})})}export{et as default};
