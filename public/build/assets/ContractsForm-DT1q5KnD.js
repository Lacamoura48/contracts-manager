import{r as _,j as e,W as V}from"./app-BccYHygl.js";import{A as H,a as I}from"./Autocomplete-BvS3zAZ0.js";import{P as A}from"./ProofInput-Bvx5Sftj.js";import{T as D}from"./TextArea-DsSXE4yj.js";import{C as p}from"./CustomInput-BUDQeq8i.js";import{T as F}from"./trash-DM-E728S.js";import{C}from"./circle-plus-CSHBc_iq.js";import{C as x}from"./CustomSelect-t6eiNOBd.js";import{S as L}from"./SubmitButton-D-FkE4aW.js";import{A as S,I as P}from"./InsideLayout-z1wwOu_U.js";import{d as j}from"./functions-BtxkZlM_.js";import"./loader-circle-06XY_3vM.js";import"./createLucideIcon-BZKTV0bn.js";import"./Checkbox-CtMW9NLa.js";import"./FileInput-B9wx0t34.js";import"./settings-CNUAiOU3.js";function T({prefrences:f,prefrencesHandler:r}){const[l,d]=_.useState(f),h=(n,c,o)=>{const b=l.map(m=>m.id===n?{...m,[c]:o}:m);d(b)};function t(n){const c=l.filter(o=>o.id!==n);d(c)}function i(){const n=[...l,{id:new Date().toString(),title:"",description:""}];d(n)}return _.useEffect(()=>{r(l)},[l]),e.jsxs("div",{children:[l.map((n,c)=>e.jsxs("div",{className:"mb-3 flex rounded-xl border border-gray-300 px-2 py-2",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(p,{label:"عنوان الوصف "+(c+1),id:`pref-title-${n.id}`,defaultValue:n.title,onBlur:o=>h(n.id,"title",o.target.value)}),e.jsx(D,{label:"تفاصيل الوصف "+(c+1),defaultValue:n.description,id:`term-${n.id}`,onBlur:o=>h(n.id,"description",o.target.value)})]}),e.jsx("button",{onClick:()=>t(n.id),className:"flex h-8 w-8 items-center justify-center rounded-full bg-black",children:e.jsx(F,{color:"white",size:18})})]},n.id)),e.jsxs("button",{onClick:i,type:"button",className:"relative top-1 my-2 w-full rounded-xl bg-gray-200 py-3 pl-4 pr-1 transition-colors duration-500 hover:bg-black hover:text-white",children:[e.jsx(C,{className:"ml-2 inline"}),"إضافة وصف"]})]})}function Z(f){const r=f.contract,l=new URLSearchParams(window.location.search),d=_.useRef(),h=r?{client_id:r.client_id,total_price:Math.round(parseFloat(r.bonds_sum_amount)),contract_type:r.bonds_count,start_date:j(new Date(r.bonds[0].created_at)),start_amount:r.bonds[0].amount,height:r.height,width:r.width,intensity:r.intensity,work_duration:r.work_duration,notes:r.notes,type:r.type,contract_prefrences:r.contract_prefrences,_method:"PATCH"}:{client_id:l.get("client_id")||"",total_price:"",contract_type:3,start_amount:"",start_date:j(new Date),bonds_array:[],height:"27cm",width:"75cm",intensity:"25kg/H",work_duration:"",type:"عقد التصنيع و التوريد",contract_prefrences:[],notes:""},{data:t,setData:i,post:n,processing:c,errors:o}=V({...h});function b(a){const u=t.bonds_array.map(g=>g.id==a.id?a:g);i("bonds_array",u)}const m=a=>[...Array(a).keys()].map(u=>{var y,v,w,k;return{id:u+1,proof_image:((y=t.bonds_array[u])==null?void 0:y.proof_image)||null,title:((v=t.bonds_array[u])==null?void 0:v.title)||"",postable:((w=t.bonds_array[u])==null?void 0:w.postable)!==void 0?(k=t.bonds_array[u])==null?void 0:k.postable:!0}}),s=a=>{i(a.target.name,a.target.type==="checkbox"?a.target.checked:a.target.value)};_.useEffect(()=>{if(+t.total_price>0)if(+t.contract_type!=3){const a=(+t.total_price/+t.contract_type).toFixed(2);i({...t,start_amount:a,bonds_array:!r&&m(+t.contract_type)}),d.current.value=a}else{const a=(+t.total_price/2).toFixed(2);i({...t,start_amount:a,bonds_array:!r&&m(+t.contract_type)}),d.current.value=a}},[t.contract_type,t.total_price]);const N=a=>{a.preventDefault(),console.log(t),r?n(route("contracts.update",r.id)):n(route("contracts.store"),{forceFormData:!0})};return e.jsx(S,{children:e.jsx(P,{headerTitle:"إضافة عقد جديد",headerLink:[{label:"إضافة زبون جديد",url:route("clients.create"),icon:C}],children:e.jsxs("form",{onSubmit:N,className:"max-w-2xl py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx(p,{label:"نوع العقد",onChange:s,defaultValue:t.type,name:"type",id:"contracts-type",error:o.type})}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsx(H,{placeholder:"إختر زبونا ",dataFunction:async a=>I("clients",a),defaultValue:t.client_id,choiceHandler:a=>i("client_id",a),listItemAtributeName:"full_name",id:"client-contract-form",label:"الزبون",error:o.client_id}),e.jsx(p,{type:"number",label:"المبلغ",placeholder:"المبلغ بالدرهم",min:"0",onChange:s,defaultValue:t.total_price,name:"total_price",id:"contracts-total_price",error:o.total_price})]}),e.jsx("div",{className:"mb-4 flex gap-3",children:e.jsxs(x,{onChange:s,label:"عدد الدفعات",id:"contracts-contract_type",name:"contract_type",defaultValue:t.contract_type,error:o.contract_type,children:[e.jsx("option",{value:3,children:"بدون إقساط"}),e.jsx("option",{value:4,children:"4 دفعات"}),e.jsx("option",{value:6,children:"6 دفعات"}),e.jsx("option",{value:8,children:"8 دفعات"}),e.jsx("option",{value:10,children:"10 دفعات"}),e.jsx("option",{value:12,children:"12 دفعات"})]})}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsx(p,{type:"date",label:"تاريخ أول دفعة",min:r?null:j(new Date),onChange:s,defaultValue:t.start_date,name:"start_date",id:"contracts-start_date",error:o.start_date}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("label",{className:"mb-1 block text-black",htmlFor:"contracts-start_amount",children:"مبلغ أول دفعة"}),e.jsx("input",{id:"contracts-start_amount",type:"number",placeholder:"المبلغ بالدرهم",min:1,step:".01",max:t.total_price,onChange:s,ref:d,defaultValue:t.start_amount,name:"start_amount",className:`w-full border-none px-2 py-2 placeholder:text-gray-400 focus:ring-black ${o.start_amount?"bg-red-100":"bg-gray-100"} placeholder:text-placeholder rounded-lg`}),e.jsx("span",{className:"text-xs text-red-600",children:o.start_amount})]})]}),e.jsx("div",{className:"mb-4 flex gap-3",children:e.jsx(p,{type:"number",label:"مدة الانجاز",placeholder:"عدد أيام",onChange:s,defaultValue:t.work_duration,name:"work_duration",id:"contracts-work_duration",error:o.work_duration})}),!r&&e.jsx("div",{className:"my-8 grid grid-cols-1 gap-x-3 gap-y-6 md:grid-cols-2",children:t.bonds_array.map(a=>e.jsx(A,{number:a.id,changeHandler:b},a.id))}),e.jsxs("div",{className:"my-4",children:[e.jsx("h2",{className:"mb-3 text-2xl font-bold",children:"المواصفات"}),e.jsxs("div",{className:"mb-8 flex gap-2",children:[e.jsxs(x,{onChange:s,defaultValue:t.intensity,name:"intensity",id:"contracts-intensity",label:"كثافة",children:[e.jsx("option",{value:"20kg/H",children:"20kg/H"}),e.jsx("option",{value:"25kg/H",children:"25kg/H"}),e.jsx("option",{value:"30kg/H",children:"30kg/H"})]}),e.jsxs(x,{onChange:s,defaultValue:t.width,name:"width",id:"contracts-width",label:"عرض",children:[e.jsx("option",{value:"70cm",children:"70cm"}),e.jsx("option",{value:"75cm",children:"75cm"}),e.jsx("option",{value:"80cm",children:"80cm"})]}),e.jsxs(x,{onChange:s,defaultValue:t.height,name:"height",id:"contracts-height",label:"ارتفاع",children:[e.jsx("option",{value:"20cm",children:"20cm"}),e.jsx("option",{value:"22cm",children:"22cm"}),e.jsx("option",{value:"25cm",children:"25cm"}),e.jsx("option",{value:"27cm",children:"27cm"}),e.jsx("option",{value:"30cm",children:"30cm"})]})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx(T,{prefrencesHandler:a=>i("contract_prefrences",a),prefrences:t.contract_prefrences})}),e.jsx("div",{children:e.jsx(L,{loading:c,children:r?"تحديث":"إرسال"})})]})})})}export{Z as default};
